generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Question {
  id               String            @id @default(cuid())
  text             String
  optionA          String
  optionB          String
  optionC          String
  optionD          String
  correctAnswer    String
  explanation      String?
  createdAt        DateTime          @default(now())
  difficulty       Difficulty        @default(MEDIUM)
  isActive         Boolean           @default(true)
  number           Int               @default(autoincrement())
  updatedAt        DateTime          @default(now()) @updatedAt
  questionAttempts QuestionAttempt[]
  tags             QuestionTag[]

}

model Tag {
  id          String        @id @default(cuid())
  name        String        @unique
  description String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  questions   QuestionTag[]
}

model QuestionTag {
  id         String   @id @default(cuid())
  questionId String
  tagId      String
  createdAt  DateTime @default(now())
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([questionId, tagId])
  @@index([questionId])
  @@index([tagId])
}

model QuestionAttempt {
  id             String   @id @default(cuid())
  questionId     String
  userId         String
  userEmail      String
  selectedAnswer String
  isCorrect      Boolean
  answeredAt     DateTime @default(now())
  question       Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([questionId])
  @@index([userId, questionId])
}

model UserStats {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  userEmail               String
  totalQuestionsAnswered  Int       @default(0)
  totalCorrectAnswers     Int       @default(0)
  easyQuestionsAnswered   Int       @default(0)
  easyCorrectAnswers      Int       @default(0)
  mediumQuestionsAnswered Int       @default(0)
  mediumCorrectAnswers    Int       @default(0)
  hardQuestionsAnswered   Int       @default(0)
  hardCorrectAnswers      Int       @default(0)
  currentStreak           Int       @default(0)
  longestStreak           Int       @default(0)
  lastAnsweredDate        DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@index([userId])
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}
